workflows:
  rf-tests:
    name: Robot Framework mobile tests
    instance_type: linux
    triggering:
      events:
        - push
    scripts:
      - name: Install Appium
        script: npm install --location=global appium
      - name: Install Robot Framework
        script: pip install robotframework robotframework-appiumlibrary
      - name: Launch emulator
        script: |
          cd $ANDROID_HOME/tools
          emulator -avd emulator &
          adb wait-for-device
      - name: Test
        script: |
          robot TestSuite.robot --outputDir rf-results
          adb logcat -d > emulator.log
          cp  -r rf-results $CM_EXPORT_DIR/rf-results
